---
import Layout from '../layouts/Layout.astro'
import { getCollection, render } from 'astro:content'
import Header from '../components/Header.astro'
import Footer from '../components/Footer.astro'
import Post from '../components/Post.astro'
import Shop from '../components/Shop.astro'

export async function getStaticPaths() {
  const collections = ['posts', 'shop']
  const paths = []
  for (const collection of collections) {
    const items = await getCollection(collection)
    paths.push(...items.map(item => ({
      params: { slug: item.data.slug },
      props: { item, type: collection }
    })))
  }
  return paths
}

const { item, type } = Astro.props
const { Content } = await render(item)
---

<Layout
  title={item.data.title}
  type={type === 'post' ? 'article' : 'og:product'}
  description={item.data.description}
>
  <Header back />
  {type === 'shop' &&
    <Shop item={item}>
      <Content />
    </Shop>
  }
  {type === 'posts' &&
    <Post item={item}>
      <Content />
    </Post>
  }
  <Footer />
</Layout>